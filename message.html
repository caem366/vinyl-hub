<select id="userDropdown" class="form-select">
  <option value="" disabled selected>Select a user</option>
</select>

<div class="mb-3">
  <label for="userSearch" class="form-label">Search for a User:</label>
  <input type="text" id="userSearch" class="form-control" placeholder="Enter username or email">
  <ul id="userSearchResults" class="list-group mt-2"></ul>
</div>
<form id="messageForm">
  <div class="mb-3">
    <label for="receiverUsername" class="form-label">Recipient Username:</label>
    <input type="text" class="form-control" id="receiverUsername" placeholder="Enter recipient's username" required>
  </div>
  <div class="mb-3">
    <label for="messageContent" class="form-label">Message:</label>
    <textarea class="form-control" id="messageContent" rows="3" placeholder="Enter your message" required></textarea>
  </div>
  <button type="submit" class="btn btn-primary">Send Message</button>
</form>

<script type="module">
  import app from './config/firebase-config.js';
  import { getFirestore, collection, query, where, getDocs } from 'https://www.gstatic.com/firebasejs/9.10.0/firebase-firestore.js';

  const db = getFirestore(app);
  const userSearch = document.getElementById('userSearch');
  const userSearchResults = document.getElementById('userSearchResults');
  const receiverIdInput = document.getElementById('receiverId');

  userSearch.addEventListener('input', async () => {
    const searchTerm = userSearch.value.trim();
    userSearchResults.innerHTML = '';

    if (searchTerm.length > 2) {
      const usersQuery = query(
        collection(db, 'users'),
        where('username', '>=', searchTerm),
        where('username', '<=', searchTerm + '\uf8ff')
      );

      const querySnapshot = await getDocs(usersQuery);
      querySnapshot.forEach((doc) => {
        const user = doc.data();
        const listItem = document.createElement('li');
        listItem.className = 'list-group-item';
        listItem.textContent = `${user.username || user.email}`;
        listItem.addEventListener('click', () => {
          receiverIdInput.value = doc.id;
          userSearch.value = user.username || user.email;
          userSearchResults.innerHTML = '';
        });
        userSearchResults.appendChild(listItem);
      });

      if (querySnapshot.empty) {
        userSearchResults.innerHTML = '<li class="list-group-item text-muted">No users found.</li>';
      }
    }
  });
</script>

<footer class="bg-dark text-white text-center py-3 mt-5">
  <p>&copy; 2025 VinylHub. All Rights Reserved.</p>
</footer>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
