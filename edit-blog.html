<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Blog Post</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdn.quilljs.com/1.3.7/quill.snow.css" rel="stylesheet">
</head>
<style>
    body {
        background-color: #343A40;  
        color: #f8f9fa; 
    }
    .container {
        max-width: 800px;
    }
    input.form-control, select.form-select, textarea.form-control {
        background-color: #6C757D;
        color: #f8f9fa;
        border: 1px solid #adb5bd;
    }
    input.form-control::placeholder, textarea.form-control::placeholder {
        color: #ced4da;
    }
    input.form-control:focus, select.form-select:focus, textarea.form-control:focus {
        background-color: #6C757D;
        color: #f8f9fa;
        border-color: #adb5bd;
        box-shadow: none;
    }
    label {
        color: #f8f9fa;
    }

    .form-text{
        color: #ced4da; 
    }
</style>
<body>
   
      <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
        <a class="navbar-brand" href="index.html">VinylHub</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto">
                <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
                <li class="nav-item"><a class="nav-link" href="catalog.html">Shop Vinyls</a></li>
                <li class="nav-item">
                    <a class="nav-link" href="create-listing.html" id="sellVinylLink">Sell Vinyl</a>
                </li>
                <li class="nav-item"><a class="nav-link" href="blog.html">Blog</a></li>
                <li class="nav-item"><a class="nav-link" href="checkout.html">Cart</a></li>
                <li class="nav-item"><a class="nav-link" href="contact.html">Contact</a></li>
                <li class="nav-item dropdown" id="accountDropdown">
                    <a class="nav-link dropdown-toggle" href="auth.html" id="accountMenu" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        Account
                    </a>
                    <ul class="dropdown-menu" aria-labelledby="accountMenu">
                        <!-- <li><a class="dropdown-item" href="auth.html">Login / Register</a></li> -->
                        <li><a class="dropdown-item" href="wishlist.html" id="wishlistLink">Wishlist</a></li>
                        <li><a class="dropdown-item" href="manage-listings.html">Manage Listings</a></li>
                        <li><a class="dropdown-item" href="manage-blog.html">Manage Blog Posts</a></li>
                        <li><a class="dropdown-item" href="inbox.html">View Inbox</a></li>
                        <li><a class="dropdown-item" href="wishlist.html" id="wishlistLink">Wishlist</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="#" id="logoutButton">Logout</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
  </nav>


    <!-- Edit Blog Form -->
    <div class="container mt-5">
        <h2 class="text-center mb-4">Edit Blog Post</h2>
        <form id="editBlogForm">
            <div class="mb-3">
                <label for="blogTitle" class="form-label">Title:</label>
                <input type="text" class="form-control" id="blogTitle" placeholder="Enter blog title" required>
            </div>
            <div class="mb-3">
                <label for="blogDescriptionEditor" class="form-label">Description:</label>
                <div id="blogDescriptionEditor" style="height: 100px;"></div>
            </div>
            <div class="mb-3">
                <label for="blogContentEditor" class="form-label">Content:</label>
                <div id="blogContentEditor" style="height: 200px;"></div>
            </div>
            <button type="submit" class="btn btn-primary w-100">Save Changes</button>
        </form>
    </div>

    <footer class="bg-dark text-white text-center py-3 mt-5">
        <p>&copy; 2025 VinylHub. All Rights Reserved.</p>
    </footer>

    <script src="https://cdn.quilljs.com/1.3.7/quill.min.js"></script>
    <script type="module">
        import app from './config/firebase-config.js';
        import { getFirestore, doc, getDoc, updateDoc } from 'https://www.gstatic.com/firebasejs/9.10.0/firebase-firestore.js';

        const db = getFirestore(app);
        const blogId = new URLSearchParams(window.location.search).get('id');
        const descriptionQuill = new Quill('#blogDescriptionEditor', {
            theme: 'snow',
            modules: {
                toolbar: [
                    ['bold', 'italic', 'underline'], // Formatting options
                    [{ list: 'ordered' }, { list: 'bullet' }], // Lists
                    [{ size: ['small', false, 'large', 'huge'] }], // Text size
                    [{ font: [] }], // Font family
                    ['link', 'image'], // Links and images
                ],
            },
        });

        const contentQuill = new Quill('#blogContentEditor', {
            theme: 'snow',
            modules: {
                toolbar: [
                    ['bold', 'italic', 'underline'], // Formatting options
                    [{ list: 'ordered' }, { list: 'bullet' }], // Lists
                    [{ size: ['small', false, 'large', 'huge'] }], // Text size
                    [{ font: [] }], // Font family
                    ['link', 'image'], // Links and images
                ],
            },
        });

        async function loadBlogDetails() {
            if (!blogId) {
                alert('No blog ID provided.');
                window.location.href = 'manage-blog.html';
                return;
            }

            const docRef = doc(db, 'blogs', blogId);
            const docSnap = await getDoc(docRef);

            if (docSnap.exists()) {
                const blog = docSnap.data();
                document.getElementById('blogTitle').value = blog.title;
                descriptionQuill.root.innerHTML = blog.description;
                contentQuill.root.innerHTML = blog.content;
            } else {
                alert('Blog not found.');
                window.location.href = 'manage-blog.html';
            }
        }

        document.getElementById('editBlogForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const updatedData = {
                title: document.getElementById('blogTitle').value,
                description: descriptionQuill.root.innerHTML.trim(), // Get formatted HTML from Quill editor
                content: contentQuill.root.innerHTML.trim(), // Get formatted HTML from Quill editor
            };

            try {
                await updateDoc(doc(db, 'blogs', blogId), updatedData);
                alert('Blog updated successfully!');
                window.location.href = 'manage-blog.html';
            } catch (error) {
                console.error('Error updating blog:', error);
                alert('Failed to update blog. Please try again.');
            }
        });

        document.addEventListener('DOMContentLoaded', loadBlogDetails);
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
